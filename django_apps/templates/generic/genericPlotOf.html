<html>
<script type="text/javascript" charset="utf-8" src="/js/JSON2.js"></script>
<script type="text/javascript">
<!-- the names will be changed, still works , too much var--> 
function dropdown(gaussVersion,pythiaVersion,eventType,gaussVersionREF,pythiaVersionREF,eventTypeREF)
{
	var mygaussVersion, mypythiaVersion,myeventType,mygaussVersionREF,mypythiaVersionREF,myeventTypeREF;	
	mygaussVersion = gaussVersion.options[gaussVersion.selectedIndex].value;
	mypythiaVersion = pythiaVersion.options[pythiaVersion.selectedIndex].value;
	myeventType = eventType.options[eventType.selectedIndex].value;
	mygaussVersionREF = gaussVersionREF.options[gaussVersionREF.selectedIndex].value;
	mypythiaVersionREF = pythiaVersionREF.options[pythiaVersionREF.selectedIndex].value;
	myeventTypeREF = eventTypeREF.options[eventTypeREF.selectedIndex].value;
	
	if(mygaussVersion == "" || mypythiaVersion == "" || myeventType == "" || mygaussVersionREF == "" || mypythiaVersionREF == "" || myeventTypeREF == "" ){
		alert("All fields must be filled!!");
		return false;
	}
	else{
		return true;
	}
}
function initializeList(list,str){

	var len = list.options.length;
   	for (i=0; i<len; i++) {
       	list.remove(0); //It is 0 (zero) intentionally
    }

	var opt = document.createElement("option");
	list.options.add(opt);
	opt.value = "";
	opt.text = str;
	list.disabled = true;
}
function updateAppVersions(id,val)
{
	var optID;
	var optID2;
	//fix the id of the option list which will be changed
	if (id == "currentApp"){
		optID = "currentVer"
		optID2 = "currentOpt"
	}
	else{
		optID = "referenceVer"
		optID2 = "referenceOpt"
	}
	//if the value is null disable the options list and remove the values
	if(val == ""){
			
			list1 = document.getElementById(optID)
			list2 = document.getElementById(optID2)

			initializeList(list1,"Select version");
			initializeList(list2,"Select option");

		return;
	}
	
	var xmlhttp;    
	if (window.XMLHttpRequest){
		// code for IE7+, Firefox, Chrome, Opera, Safari
  		xmlhttp=new XMLHttpRequest();
  	}
	else{
		// code for IE6, IE5
  		xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  	}

	// when the response comes do...
	xmlhttp.onreadystatechange=function(){
  		if (xmlhttp.readyState==4 && xmlhttp.status==200){

			// find the option list which will be changed
			var optionList = document.getElementById(optID);
			var optionList2 = document.getElementById(optID2);
			
			//initialize the lists before update them
			initializeList(optionList,"Select version");
			initializeList(optionList2,"Select option");
			optionList.disabled = false;
	
			//parse the server response
			var jsondata = JSON.parse(xmlhttp.responseText);
			var apps = jsondata.appVersions;
			
			//loop over the array which contains the versions
			for(var i = 0; i < apps.length; i++){
				var opt = document.createElement("option");
				optionList.options.add(opt);
				opt.value = apps[i];
				opt.text = apps[i];
			}
    	}
  	}

	if(val == ""){
		//todo
	}
	else{
			// send the request the to server
			xmlhttp.open("GET","/generic/service?service=version&key="+val,true);
			xmlhttp.send();
		}
	
}
function updateOptions(id,val)
{
	var optID;
	var optID2; // gaussVersion
	//fix the id of the option list which will be changed
	if (id == "currentVer"){
		optID = "currentOpt";
		optID2 = "currentApp";
	}
	else{
		optID = "referenceOpt";
		optID2 = "referenceApp";
	}

	//if the value is null disable the options list and remove the values
	if(val == ""){			
			list = document.getElementById(optID)
			initializeList(list,"Select option");

		return;
	}
	
	var xmlhttp;    
	if (window.XMLHttpRequest){
		// code for IE7+, Firefox, Chrome, Opera, Safari
  		xmlhttp=new XMLHttpRequest();
  	}
	else{
		// code for IE6, IE5
  		xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  	}

	// when the response comes do...
	xmlhttp.onreadystatechange=function(){
  		if (xmlhttp.readyState==4 && xmlhttp.status==200){

			// find the option list which will be changed
			var optionList = document.getElementById(optID);
			
			//initialize the lists before update them
			initializeList(optionList,"Select option");
			optionList.disabled = false;
	
			//parse the server response
			var jsondata = JSON.parse(xmlhttp.responseText);
			var events = jsondata.optionsList;
			
			//loop over the array which contains the versions
			for(var i = 0; i < events.length; i++){
				var opt = document.createElement("option");
				optionList.options.add(opt);
				opt.value = events[i];
				opt.text = events[i];
			}
    	}
  	}

	if(val == ""){
		//todo
	}
	else{
			// send the request the to server
			var App = document.getElementById(optID2);
			app = App.options[App.selectedIndex].value;
			xmlhttp.open("GET","/generic/service?service=options&appl="+app+"&version="+val,true);
			xmlhttp.send();
		}
	
}
</script>

<link rel="stylesheet" href="http://lhcb-release-area.web.cern.ch/LHCb-release-area/DOC/css/lhcb.css" type="text/css" media="screen">
<link rel="stylesheet" href="http://lhcb-release-area.web.cern.ch/LHCb-release-area/DOC/gauss/css/css.css" type="text/css" media="screen">
<link rel="stylesheet" href="css.css" type="text/css" media="screen">
<title>One generator plot example</title>
</HEAD>
<BODY>
<div class="ctitle">
<TABLE id="pagetitle">
<TBODY>
<TR>
<TD class=iconspace>
<A href="http://cern.ch/lhcb-comp">
<IMG id=lhcblogo  src="http://lhcb-release-area.web.cern.ch/LHCb-release-area/DOC/images/lhcbcomputinglogo.gif" >
</A>
</TD>
<TD vAlign=middle align=center>
<H1><a href="/genplot" >Generator Plot test</a></H1></TD>
</TR>
</TBODY>
</TABLE>
</div>
<div class=pagebody>
<div id=manifest>
<p>Press the button the compare the two jobs</p>
</div>
<h2>Just press the button</h2>

<FORM 
     ACTION="/generic/results/" 
     METHOD="POST" 
	 onSubmit="return dropdown(this.application,this.AppVersion,this.Options,this.applicationREF,this.AppVersionREF,this.OptionsREF)">
{% csrf_token %}
<TABLE>
<TR><TD></TD><TD>Application</TD><TD>Version</TD><TD>Options(eventType)</TD></TR>
<TR>
<TD><div class=firstcell>Current</div></TD>
<TD>
<!-- App == application -->
<SELECT ID="currentApp" NAME="application" onchange="updateAppVersions(this.id,this.value)">
<OPTION  VALUE="">Select application
{% for app in applications %}
<OPTION VALUE="{{ app }}">{{ app }}
{% endfor %}
</SELECT>
</TD>
<TD>
<!-- Ver == Version -->
<SELECT ID="currentVer" NAME="AppVersion" onchange="updateOptions(this.id,this.value)" disabled="true">
<OPTION  VALUE="">Select version
</SELECT>
</TD>
<TD>
<!-- Opt == Options -->
<SELECT ID="currentOpt" NAME="Options" disabled="true">
<OPTION  VALUE="">Select option
</SELECT>
</TD>
</TR>

<TR>
<TD><div class=firstcell style=background-color:red>Reference</div></TD>
<TD>
<!-- App == application -->
<SELECT ID="referenceApp" NAME="applicationREF" onchange="updateAppVersions(this.id,this.value)">
<OPTION  VALUE="">Select application
{% for app in applications %}
<OPTION VALUE="{{ app }}">{{ app }}
{% endfor %}
</SELECT>
</TD>
<TD>
<!-- Ver == Version -->
<SELECT ID="referenceVer" NAME="AppVersionREF" onchange="updateOptions(this.id,this.value)" disabled="true">
<OPTION  VALUE="">Select version
</SELECT>
</TD>
<TD>
<!-- Opt == Options -->
<SELECT ID="referenceOpt" NAME="OptionsREF" disabled="true">
<OPTION  VALUE="">Select option
</SELECT>
</TD>
</TR>

<TR>
<TD></TD>
<TD>
<INPUT TYPE=SUBMIT VALUE="Compare" >
</TD>
<TD></TD><TD></TD>
</TR>
</TABLE>
</FORM>

</BODY>
</HTML>
