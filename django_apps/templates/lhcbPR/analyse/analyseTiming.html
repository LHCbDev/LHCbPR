{% extends "lhcbPR/analyse/analysis_template.html" %}

{% block title %} {{ active_tab }} timing analysis {% endblock %}

{% block script %}
			function clearCheckBox2(id){
				nodes = document.getElementById(id).children;
				for(i=0; i<nodes.length; i+=1) {
    				if (nodes[i].children[0].children[0].checked == true){
						nodes[i].children[0].children[0].checked = false;
					}
				}
				return;
			}

			$(document).ready(function() {				
				$('#execute_query').hover(
					function() { $(this).addClass('ui-state-hover'); },
					function() { $(this).removeClass('ui-state-hover'); }
				);
				
				$("#HostButton").click(function(){ showHide("HostButton","Host") });
			  	$("#OptionsButton").click(function(){ showHide("OptionsButton","Options") });
			  	$("#PlatformButton").click(function(){ showHide("PlatformButton","Platform") });
			  	$("#VersionButton").click(function(){ showHide("VersionButton","Version") });

				$("#HostErase").click(function(){ clearCheckBox2("Host") });
			 	$("#OptionsErase").click(function(){ clearCheckBox2("Options") });
			  	$("#PlatformErase").click(function(){ clearCheckBox2("Platform") });
				$("#VersionErase").click(function(){ clearCheckBox2("Version") });

				$("#execute_query").click(function() { query(); });

				 $('body').ajaxComplete(function(e, xhr, settings) {
					if (xhr.status == 278) {
						window.location.href = xhr.getResponseHeader("Location").replace(/\?.*$/, "?next="+window.location.pathname);
        			}
    			});
				
			});

function query(){
	var options = getSelectedChilds("Options");
	var versions = getSelectedChilds("Version");
	var platforms = getSelectedChilds("Platform");
	var hosts = getSelectedChilds("Host");
	var appName = "{{  active_tab }}";
	
	var group_by_host = $("#group_by_host").is(':checked');
	
	$("#results").mask("Requesting...");
	
	document.location.href= "/django/lhcbPR/analysis_function/?analysis_type=timing&platforms="+escape(platforms.join(","))+"&hosts="+escape(hosts.join(","))+"&versions="+escape(versions.join(","))+"&options="+escape(options.join(","))+"&appName="+appName+"&group_host="+group_by_host;
	/* $.ajax({
    	'url' : '/django/lhcbPR/analysis_function/',
		'type' : 'GET',
		'data' : {
		'analysis_type' : 'timing',
		'platforms' : platforms.join(","),
		'hosts' : hosts.join(","),
		'versions' : versions.join(","),
		'options' : options.join(","),
		'appName' : appName,
		'group_host' : group_by_host,
		},
    	'success' : function(data) {}
    }); */
	return;
}
{% endblock script %}

{% block stylecss %}
	#execute_query { padding: .4em 1em .2em 17px;text-decoration: none;position: relative; float: right;}
	#filter_container { padding-top: 0.5em; padding-bottom: 0.5em; }
	#group_host { margin-top: 0.5em; }
{% endblock stylecss %}

{% block helptext %}

{% endblock helptext %}


{% block content %}
			<a  id="execute_query" class="ui-state-default ui-corner-all" href="javascript:;"  title="bookmark your selection"> Retrieve results </a>

					<div class="Outer">

					<div id="filter_container" class="InnerLeft">	

						<label style="font-weight:bold;">Timing analysis </label>
						
						<table class="filter" style="margin-top: 1em;">
						<tr>
						<td><a href="javascript:;" id="OptionsButton" class="ui-state-default ui-corner-all filterButton"><span class="ui-icon ui-icon-minusthick"></span>Options</a>
								<a href="javascript:;" id="OptionsErase" class="ui-state-default ui-corner-all filterErase"  title="clear checkbox" ><span class="ui-icon ui-icon-closethick"></span></a>
						</td>
						<tr>
						<td>
						    <ul id="Options" name="Options" class="checklist" >
								{% for opt in options %}
								<li>
										<label id="Options{{ forloop.counter }}">
											<input id="Options{{ forloop.counter }}a" type="checkbox" value="{{ opt.value }}" {% if opt.checked %} checked="checked"  {% endif %}>
												{{ opt.value }}
										 </label>
								</li>
							{% endfor %}
						</td>
						<tr>
						<td><a href="javascript:;" id="VersionButton" class="ui-state-default ui-corner-all filterButton"><span class="ui-icon ui-icon-minusthick"></span>Version</a>
								<a href="javascript:;" id="VersionErase" class="ui-state-default ui-corner-all filterErase"  title="clear checkbox"><span class="ui-icon ui-icon-closethick"></span></a>
						</td>
						<tr>
						<td>
				 		   <ul id="Version" name="Version" class="checklist">
							{% for v in versions %}
								<li>
										<label id="Version{{ forloop.counter }}">
											<input id="Version{{ forloop.counter }}a" type="checkbox" value="{{ v.value }}" {% if plat.checked %} checked="checked"  {% endif %}>
												{{ v.value }}
										 </label>
								</li>
							{% endfor %}
						    </ul>
						</td>
						<tr>
						<td><a href="javascript:;" id="PlatformButton" class="ui-state-default ui-corner-all filterButton"><span class="ui-icon ui-icon-plusthick"></span>Platform</a>
								<a href="javascript:;" id="PlatformErase" class="ui-state-default ui-corner-all filterErase"  title="clear checkbox"><span class="ui-icon ui-icon-closethick"></span></a>
						</td>
						<tr>
						<td>
				 		   <ul id="Platform" name="Platform" class="checklist" style="display:none;">
							{% for plat in platforms %}
								<li>
										<label id="Platform{{ forloop.counter }}">
											<input id="Platform{{ forloop.counter }}a" type="checkbox" value="{{ plat.value }}" {% if plat.checked %} checked="checked"  {% endif %}>
												{{ plat.value }}
										 </label>
								</li>
							{% endfor %}
						    </ul>
						</td>
						<tr>
						<td><a href="javascript:;" id="HostButton" class="ui-state-default ui-corner-all filterButton"><span class="ui-icon ui-icon-plusthick"></span>Host</a>
								<a href="javascript:;" id="HostErase" class="ui-state-default ui-corner-all filterErase"  title="clear checkbox" ><span class="ui-icon ui-icon-closethick"></span></a>
						</td>
						<tr>
						<td>
						    <ul id="Host" name="Host" class="checklist" style="display: none;">
								{% for h in hosts %}
								<li>
										<label id="Host{{ forloop.counter }}">
											<input id="Host{{ forloop.counter }}a" type="checkbox" value="{{ h.value }}" {% if h.checked %} checked="checked"  {% endif %}>
												{{ h.value }}
										 </label>
								</li>
							{% endfor %}
						</td>
						</table><!-- closing div id=myfilter -->
					</div><!-- /filter_container + InnerLeft(has two classes)-->				
				
					<div id="group_host">
							<label><input id="group_by_host" type="checkbox">group by host</label>
						</div>					

					<div id="results" class="InnerRight" style="margin-top: 2em;margin-left:1em;"></div><!-- /resutls + InnerRight (has two classes)-->
					
				</div><!-- /Outer-->	
{% endblock content %}
