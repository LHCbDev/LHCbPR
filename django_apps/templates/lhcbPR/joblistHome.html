{% extends "lhcbPR/base_template.html" %}

{% block title %} Job List {% endblock title %}

{% block head %}
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
google.load('visualization', '1', {packages: ['table']});

var cnf_data;
var cnf_view;

function drawVisualization() {
   // Create and populate the data table.
	var cnfs = {{ configs|safe }};
   cnf_data = google.visualization.arrayToDataTable(cnfs);
   cnf_data.setColumnLabel(0, "Id");
   cnf_data.setColumnLabel(1, "Project");
   cnf_data.setColumnLabel(2, "Version");
   cnf_data.setColumnLabel(3, "Platform");
   cnf_data.setColumnLabel(4, "Options Name");
   cnf_data.setColumnLabel(5, "Options");
   cnf_data.setColumnLabel(6, "Setup Name");
   cnf_data.setColumnLabel(7, "Setup Options");

   cnf_view = new google.visualization.DataView(cnf_data);
   cnf_view.setColumns([0, 1, 2, 3, 4, 5, 6, 7]);

   var linesPerPage   = 16;
   var pageTableIndex =  0;
   var pageTableCount = Math.ceil(cnf_data.getNumberOfRows()/linesPerPage);

   // Create and draw the visualization.
   cnf_visualization = new google.visualization.Table(document.getElementById('left'));

   var cnfStyle = {
      oddTableRow : 'google-table-row',
      headerCell  : 'google-table-head'
   }

   cnf_visualization.draw(cnf_view, {
      allowHtml: true,
      width: 800,
      height: 750,
      page: 'enable',
      pageSize : linesPerPage,
      pagingSymbols: {prev: 'prev', next: 'next'},
      pagingButtonsConfiguration: 'auto',
      chartArea: {
         left: 250,
         width: "60%"
      },
      alternatingRowStyle: true,
      cssClassNames: cnfStyle
   });

   google.visualization.events.addListener(cnf_visualization, 'select', handleConfigs);
}

// Handler to set configuration info
function handleConfigs()
{
   var selection      = cnf_visualization.getSelection();
   var description_id = cnf_data.getValue(selection[0].row, 0);
   var app_name       = cnf_data.getValue(selection[0].row, 1);
   location.href = "{{ ROOT_URL }}joblistInfo/" + app_name + "/" + description_id;
}

google.setOnLoadCallback(drawVisualization);
</script>
{% endblock head %}

{% block script %}

$(document).ready(function () {
   $("#jobListMenu").attr('checked', 'checked').button("refresh");
   $('#AlltabButton').click(function(){
      document.location.href="{{ ROOT_URL }}joblist/All/" ;
      $("#{{ active_tab }}tab").mask("Loading...");
   });
   {% for app in applications %}
   $('#{{ app }}tabButton').click(function(){
      document.location.href="{{ ROOT_URL }}joblist/{{ app }}/" ;
      $("#{{ active_tab }}tab").mask("Loading...");
   });
   {% endfor %}

	$('#tabs').tabs({ selected : -1 });
	$('#tabs').tabs('select', '#{{ active_tab }}tab');

   $("button").button();
});

{% endblock script %}

{% block stylecss %}

#main {
    width: 1200px;
    height: 750px;
}
#header {
    width: 1200px;
    height: 30px;
}
#left {
    width: 800px;
    height: 700px;
    margin-left: 30px;
    float:left;
}
#right {
    height: 700px;
}
#footer {
    width: 1200px;
    height: 20px;
}
.google-table-row {
   background-color:  lightblue;
}
.google-table-head {
   background-color: skyblue;
   font-size: 12px;
   height: 20px;
}
.google-table td {
   font-size: 10px;
   height: 30px;
}

{% endblock stylecss %}

{% block helptext %} {% endblock helptext %}

{% block pagebody %}

<div id="tabs">
   <ul>
		<li><a id="AlltabButton" href="#Alltab">All</a></li>
		{% for app in applications %}
		<li><a id="{{ app }}tabButton" href="#{{ app }}tab">{{ app }}</a></li>
		{% endfor %}
   </ul>
   <div id="{{ active_tab }}tab">
   <div id="header"></div>
   <div id="main">
      <div id="left" class="google-table"></div>
      <div id="right" class="google-table"></div>
      <div id="cleaner"> 
   </div>
   <div id="footer"></div>
   </div>
</div>

{% endblock pagebody %}
